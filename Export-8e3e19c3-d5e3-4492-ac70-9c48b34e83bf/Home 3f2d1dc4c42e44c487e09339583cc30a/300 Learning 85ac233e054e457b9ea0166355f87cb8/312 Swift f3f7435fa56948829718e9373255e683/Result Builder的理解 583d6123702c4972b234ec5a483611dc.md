# Result Builderçš„ç†è§£

Like its name implies, Swiftâ€™s result builders feature essentially lets us build a result by combining multiple expressions into a single value.

<aside>
ğŸ’¡ Just like aÂ [property wrapper](https://www.swiftbysundell.com/articles/property-wrappers-in-swift), a result builder is implemented as a normal Swift type thatâ€™s annotated with a special attribute â€”Â `@resultBuilder`
Â in this case.
Then, specific method names are used to implement its various capabilities.

</aside>

### è²Œä¼¼äº†è§£äº†ä¸€äº›ï¼š

1. æ€»çš„æ¥è¯´å°±æ˜¯è¦å®ç° @resultBuilderè¿™ä¸ªåŠŸèƒ½ï¼Œå¿…é¡»å®ç°Nå¤šä¸ªbuildBlockçš„æ–¹æ³•ï¼Œâ€œä¸ºæ„å»ºå™¨ç±»å‹æä¾›è¶³å¤Ÿçš„ç»“æœæ„å»ºæ–¹æ³•å­é›†â€ã€‚
2. è¿™äº›æ–¹æ³•æœ‰æ— å‚æ•°çš„ï¼Œæœ‰å˜å‚æ•°çš„ï¼Œè¿˜æœ‰é’ˆå¯¹ifï¼Œelse æˆ–è€…optionalå€¼çš„å¤šç§æƒ…å†µã€‚ç„¶åç¼–è¯‘å™¨ä¼šæ›´å…·è°ƒç”¨æ–¹æ³•æ¯”åŒ…é‡Œé¢çš„å†…å®¹é€‰æ‹©ï¼Œæ¥ç”Ÿæˆæœ€ç»ˆçš„ä¸€ä¸ªå€¼(Value)ã€‚è¿™ä¸ªå€¼æ˜¯buildBlock() -> Valueæ–¹æ³•å†³å®š
3. è‡³äºå¦‚ä½•å®ç°ä¸åŒçš„buildBlockæ–¹æ³•çš„å¯¹åº”é€‰æ‹©ï¼Œæ˜¯ç¼–è¯‘å™¨çº§åˆ«çš„ ad hoc åè®®ï¼Œå…·ä½“å®ç°ä¸å¾—è€ŒçŸ¥äº†ã€‚[ç¼–è¯‘å™¨åšäº†ä¸€äº›å¯ä»¥ç†è§£çš„å·¥ä½œï¼Œå¯ä»¥çœ‹ä¸‹é¢å†…å®¹](Result%20Builder%E7%9A%84%E7%90%86%E8%A7%A3%20583d6123702c4972b234ec5a483611dc.md)

### å¯èƒ½çš„å†…å¹•ï¼šæ„å»ºå™¨è½¬è¯‘çš„é€»è¾‘

ç¼–è¯‘å™¨ä¼šåšä¸€äº›å¹•åäº‹æƒ…ï¼Œä¾‹å¦‚

```swift
@AttributedStringBuilder
var myFirstText: AttributedString {
    "Hello"
    AttributedString("World")
         .color(.red)
}
```

ç¼–è¯‘å™¨ä¼šè½¬è¯‘æˆä¸‹é¢çš„ä»£ç ï¼šä¸Šä¸‹ä¸¤æ®µä»£ç å®Œå…¨ç­‰ä»·ï¼ŒSwift ä¼šåœ¨å¹•åè‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆäº†è¿™ä¸ªè¿‡ç¨‹ã€‚

```swift
var myFirstText: AttributedString {
    let _a = AttributedStringBuilder.buildExpression("Hello")  // è°ƒç”¨é’ˆå¯¹ String çš„ buildExpression
    let _b = AttributedStringBuilder.buildExpression(AttributedString("World").color(.red)) // è°ƒç”¨é’ˆå¯¹ AtributedString çš„ buildExpression
    return AttributedStringBuilder.buildBlock(_a,_b) // è°ƒç”¨æ”¯æŒå¤šå‚æ•°çš„ buildBloack
}
```

æ ¸å¿ƒå°±æ˜¯ç”Ÿæˆcomponentç±»å‹ï¼Œç„¶åè°ƒç”¨buildBlockæ¥ç”Ÿæˆæ–°çš„component

æ€»ä¹‹å°±æ˜¯ç¼–è¯‘å™¨ä¼šé’ˆå¯¹é—­åŒ…é‡Œé¢çš„æ¯è¡Œå†…å®¹è§£æï¼Œé€‰æ‹©åˆé€‚çš„buildBlockï¼Œç”šè‡³é€’å½’è°ƒç”¨ï¼Œæœ€ç»ˆæŠŠæ•´ä¸ªé—­åŒ…æ•´æˆä¸€ä¸ªæ—¢å®šçš„Componentç±»å‹è¿”å›å€¼ã€‚

## å¯èƒ½çš„å»¶ä¼¸

åœ¨ResultBuilderåˆå¹¶å„ä¸ªé¡¹ç›®æ—¶å€™ï¼Œå¯èƒ½ä¼šç¢°åˆ°é¡¹ç›®ä¸ä¸€è‡´ï¼Œè¿™æ—¶å€™å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„åè®®ï¼Œè®©æ‰€æœ‰çš„é¡¹ç›®éƒ½éµå¾ªè¿™ä¸ªåè®®ï¼Œå†åœ¨buildBlockæ–¹æ³•é‡Œé¢å»å…·ä½“å®æ–½å„ä¸ªç±»åˆ«çš„å…·ä½“æ–¹æ³•ã€‚ä¾‹å¦‚åœ¨[Sundellçš„èŒƒä¾‹](https://www.swiftbysundell.com/articles/deep-dive-into-swift-function-builders/)ä¸­ï¼Œå°±åˆ›å»ºäº†ä¸€ä¸ªSettingConvertableåè®®ç”¨æ¥æå–ä¸åŒç±»å‹Settingå’ŒSettingGroupä¹‹é—´çš„å…±åŒæ€§ï¼Œé€šè¿‡æ–¹æ³•è¿”å›[Setting]ï¼Œè¿™ä¸ªæ€è·¯å°±æ˜¯OOPçš„æ€è·¯ï¼Œå€¼å¾—å…³æ³¨

```swift
protocol SettingsConvertible {
    func asSettings() -> [Setting]
}

extension Setting: SettingsConvertible {
    func asSettings() -> [Setting] { [self] }
}

extension SettingsGroup: SettingsConvertible {
    func asSettings() -> [Setting] {
        [Setting(name: name, value: .group(settings()))]
    }
}
```