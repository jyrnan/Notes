# è¯»æ‡‚diff - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—

**[ç›´è¾¾Gitæ ¼å¼çš„diffè§£é‡Š](%E8%AF%BB%E6%87%82diff%20-%20%E9%98%AE%E4%B8%80%E5%B3%B0%E7%9A%84%E7%BD%91%E7%BB%9C%E6%97%A5%E5%BF%97%206f6a4af91dd84e4594536dabdae5fc32.md)**

diffæ˜¯Unixç³»ç»Ÿçš„ä¸€ä¸ªå¾ˆé‡è¦çš„å·¥å…·ç¨‹åºã€‚

å®ƒç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªæ–‡æœ¬æ–‡ä»¶çš„å·®å¼‚ï¼Œæ˜¯ä»£ç ç‰ˆæœ¬ç®¡ç†çš„åŸºçŸ³ä¹‹ä¸€ã€‚ä½ åœ¨å‘½ä»¤è¡Œä¸‹ï¼Œè¾“å…¥ï¼š

> 
> 
> 
> $ diff <å˜åŠ¨å‰çš„æ–‡ä»¶> <å˜åŠ¨åçš„æ–‡ä»¶>
> 

diffå°±ä¼šå‘Šè¯‰ä½ ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶æœ‰ä½•å·®å¼‚ã€‚å®ƒçš„æ˜¾ç¤ºç»“æœä¸å¤ªå¥½æ‡‚ï¼Œä¸‹é¢æˆ‘å°±æ¥è¯´æ˜ï¼Œå¦‚ä½•è¯»æ‡‚diffã€‚

![%E8%AF%BB%E6%87%82diff%20-%20%E9%98%AE%E4%B8%80%E5%B3%B0%E7%9A%84%E7%BD%91%E7%BB%9C%E6%97%A5%E5%BF%97%206f6a4af91dd84e4594536dabdae5fc32/bg2012082901.png](%E8%AF%BB%E6%87%82diff%20-%20%E9%98%AE%E4%B8%80%E5%B3%B0%E7%9A%84%E7%BD%91%E7%BB%9C%E6%97%A5%E5%BF%97%206f6a4af91dd84e4594536dabdae5fc32/bg2012082901.png)

**ä¸€ã€diffçš„ä¸‰ç§æ ¼å¼**

ç”±äºå†å²åŸå› ï¼Œdiffæœ‰ä¸‰ç§æ ¼å¼ï¼š

> 
> 
> 
> * æ­£å¸¸æ ¼å¼ï¼ˆnormal diffï¼‰
> 
> * ä¸Šä¸‹æ–‡æ ¼å¼ï¼ˆcontext diffï¼‰
> 
> * åˆå¹¶æ ¼å¼ï¼ˆunified diffï¼‰
> 

æˆ‘ä»¬ä¾æ¬¡æ¥çœ‹ã€‚

**äºŒã€ç¤ºä¾‹æ–‡ä»¶**

ä¸ºäº†ä¾¿äºè®²è§£ï¼Œå…ˆæ–°å»ºä¸¤ä¸ªç¤ºä¾‹æ–‡ä»¶ã€‚

ç¬¬ä¸€ä¸ªæ–‡ä»¶å«åšf1ï¼Œå†…å®¹æ˜¯æ¯è¡Œä¸€ä¸ªaï¼Œä¸€å…±7è¡Œã€‚

> 
> 
> 
> a a a a a a a
> 

ç¬¬äºŒä¸ªæ–‡ä»¶å«åšf2ï¼Œä¿®æ”¹f1è€Œæˆï¼Œç¬¬4è¡Œå˜æˆbï¼Œå…¶ä»–ä¸å˜ã€‚

> 
> 
> 
> a a a **b** a a a
> 

**ä¸‰ã€æ­£å¸¸æ ¼å¼çš„diff**

ç°åœ¨å¯¹f1å’Œf2è¿›è¡Œæ¯”è¾ƒï¼š

> 
> 
> 
> $ diff f1 f2
> 

è¿™æ—¶ï¼Œdiffå°±ä¼šæ˜¾ç¤ºæ­£å¸¸æ ¼å¼çš„ç»“æœï¼š

> 
> 
> 
> 4c4 < a --- > b
> 

ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæç¤ºï¼Œç”¨æ¥è¯´æ˜å˜åŠ¨ä½ç½®ã€‚

> 
> 
> 
> 4c4
> 

å®ƒåˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼šå‰é¢çš„"4"ï¼Œè¡¨ç¤ºf1çš„ç¬¬4è¡Œæœ‰å˜åŒ–ï¼›ä¸­é—´çš„"c"è¡¨ç¤ºå˜åŠ¨çš„æ¨¡å¼æ˜¯å†…å®¹æ”¹å˜ï¼ˆchangeï¼‰ï¼Œå…¶ä»–æ¨¡å¼è¿˜æœ‰"å¢åŠ "ï¼ˆaï¼Œä»£è¡¨additionï¼‰å’Œ"åˆ é™¤"ï¼ˆdï¼Œä»£è¡¨deletionï¼‰ï¼›åé¢çš„"4"ï¼Œè¡¨ç¤ºå˜åŠ¨åå˜æˆf2çš„ç¬¬4è¡Œã€‚

ç¬¬äºŒè¡Œåˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ã€‚

> 
> 
> 
> < a
> 

å‰é¢çš„å°äºå·ï¼Œè¡¨ç¤ºè¦ä»f1å½“ä¸­å»é™¤è¯¥è¡Œï¼ˆä¹Ÿå°±æ˜¯ç¬¬4è¡Œï¼‰ï¼Œåé¢çš„"a"è¡¨ç¤ºè¯¥è¡Œçš„å†…å®¹ã€‚

ç¬¬ä¸‰è¡Œç”¨æ¥åˆ†å‰²f1å’Œf2ã€‚

> 
> 
> 
> ---
> 

ç¬¬å››è¡Œï¼Œç±»ä¼¼äºç¬¬äºŒè¡Œã€‚

> 
> 
> 
> > b
> 

å‰é¢çš„å¤§äºå·è¡¨ç¤ºf2å¢åŠ äº†è¯¥è¡Œï¼Œåé¢çš„"b"è¡¨ç¤ºè¯¥è¡Œçš„å†…å®¹ã€‚

æœ€æ—©çš„[Unix](https://www.ruanyifeng.com/blog/2010/03/unix_copyright_history.html)ï¼ˆå³AT&Tç‰ˆæœ¬çš„Unixï¼‰ï¼Œä½¿ç”¨çš„å°±æ˜¯è¿™ç§æ ¼å¼çš„diffã€‚

**å››ã€ä¸Šä¸‹æ–‡æ ¼å¼çš„diff**

ä¸Šä¸ªä¸–çºª80å¹´ä»£åˆï¼ŒåŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡æ¨å‡ºBSDç‰ˆæœ¬çš„Unixæ—¶ï¼Œè§‰å¾—diffçš„æ˜¾ç¤ºç»“æœå¤ªç®€å•ï¼Œæœ€å¥½åŠ å…¥ä¸Šä¸‹æ–‡ï¼Œä¾¿äºäº†è§£å‘ç”Ÿçš„å˜åŠ¨ã€‚å› æ­¤ï¼Œæ¨å‡ºäº†ä¸Šä¸‹æ–‡æ ¼å¼çš„diffã€‚

å®ƒçš„ä½¿ç”¨æ–¹æ³•æ˜¯åŠ å…¥cå‚æ•°ï¼ˆä»£è¡¨contextï¼‰ã€‚

> 
> 
> 
> $ diff -c f1 f2
> 

æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š

> 
> 
> 
> *** f1 2012-08-29 16:45:41.000000000 +0800 --- f2 2012-08-29 16:45:51.000000000 +0800 *************** *** 1,7 **** a a a !a a a a --- 1,7 ---- a a a !b a a a
> 

è¿™ä¸ªç»“æœåˆ†æˆå››ä¸ªéƒ¨åˆ†ã€‚

ç¬¬ä¸€éƒ¨åˆ†çš„ä¸¤è¡Œï¼Œæ˜¾ç¤ºä¸¤ä¸ªæ–‡ä»¶çš„åŸºæœ¬æƒ…å†µï¼šæ–‡ä»¶åå’Œæ—¶é—´ä¿¡æ¯ã€‚

> 
> 
> 
> *** f1 2012-08-29 16:45:41.000000000 +0800 --- f2 2012-08-29 16:45:51.000000000 +0800
> 

"***"è¡¨ç¤ºå˜åŠ¨å‰çš„æ–‡ä»¶ï¼Œ"---"è¡¨ç¤ºå˜åŠ¨åçš„æ–‡ä»¶ã€‚

ç¬¬äºŒéƒ¨åˆ†æ˜¯15ä¸ªæ˜Ÿå·ï¼Œå°†æ–‡ä»¶çš„åŸºæœ¬æƒ…å†µä¸å˜åŠ¨å†…å®¹åˆ†å‰²å¼€ã€‚

> 
> 
> 
> ***************
> 

ç¬¬ä¸‰éƒ¨åˆ†æ˜¾ç¤ºå˜åŠ¨å‰çš„æ–‡ä»¶ï¼Œå³f1ã€‚

> 
> 
> 
> *** 1,7 **** a a a !a a a a
> 

è¿™æ—¶ä¸ä»…æ˜¾ç¤ºå‘ç”Ÿå˜åŒ–çš„ç¬¬4è¡Œï¼Œè¿˜æ˜¾ç¤ºç¬¬4è¡Œçš„å‰é¢ä¸‰è¡Œå’Œåé¢ä¸‰è¡Œï¼Œå› æ­¤ä¸€å…±æ˜¾ç¤º7è¡Œã€‚æ‰€ä»¥ï¼Œå‰é¢çš„"*** 1,7 ****"å°±è¡¨ç¤ºï¼Œä»ç¬¬1è¡Œå¼€å§‹è¿ç»­7è¡Œã€‚

å¦å¤–ï¼Œæ–‡ä»¶å†…å®¹çš„æ¯ä¸€è¡Œæœ€å‰é¢ï¼Œè¿˜æœ‰ä¸€ä¸ªæ ‡è®°ä½ã€‚å¦‚æœä¸ºç©ºï¼Œè¡¨ç¤ºè¯¥è¡Œæ— å˜åŒ–ï¼›å¦‚æœæ˜¯æ„Ÿå¹å·ï¼ˆ!ï¼‰ï¼Œè¡¨ç¤ºè¯¥è¡Œæœ‰æ”¹åŠ¨ï¼›å¦‚æœæ˜¯å‡å·ï¼ˆ-ï¼‰ï¼Œè¡¨ç¤ºè¯¥è¡Œè¢«åˆ é™¤ï¼›å¦‚æœæ˜¯åŠ å·ï¼ˆ+ï¼‰ï¼Œè¡¨ç¤ºè¯¥è¡Œä¸ºæ–°å¢ã€‚

ç¬¬å››éƒ¨åˆ†æ˜¾ç¤ºå˜åŠ¨åçš„æ–‡ä»¶ï¼Œå³f2ã€‚

> 
> 
> 
> --- 1,7 ---- a a a !b a a a
> 

é™¤äº†å˜åŠ¨è¡Œï¼ˆç¬¬4è¡Œï¼‰ä»¥å¤–ï¼Œä¹Ÿæ˜¯ä¸Šä¸‹æ–‡å„æ˜¾ç¤ºä¸‰è¡Œï¼Œæ€»å…±æ˜¾ç¤º7è¡Œã€‚

<aside>
ğŸ’¡ ğŸ‘‡ä¸‹é¢å¼€å§‹æ˜¯å’ŒGitç›¸å…³çš„diffæ ¼å¼è§£è¯»

</aside>

**äº”ã€åˆå¹¶æ ¼å¼çš„diff**

å¦‚æœä¸¤ä¸ªæ–‡ä»¶ç›¸ä¼¼åº¦å¾ˆé«˜ï¼Œé‚£ä¹ˆä¸Šä¸‹æ–‡æ ¼å¼çš„diffï¼Œå°†æ˜¾ç¤ºå¤§é‡é‡å¤çš„å†…å®¹ï¼Œå¾ˆæµªè´¹ç©ºé—´ã€‚1990å¹´ï¼ŒGNU diffç‡å…ˆæ¨å‡ºäº†"åˆå¹¶æ ¼å¼"çš„diffï¼Œå°†f1å’Œf2çš„ä¸Šä¸‹æ–‡åˆå¹¶åœ¨ä¸€èµ·æ˜¾ç¤ºã€‚

å®ƒçš„ä½¿ç”¨æ–¹æ³•æ˜¯åŠ å…¥uå‚æ•°ï¼ˆä»£è¡¨unifiedï¼‰ã€‚

> 
> 
> 
> $ diff -u f1 f2
> 

æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š

> 
> 
> 
> --- f1 2012-08-29 16:45:41.000000000 +0800 +++ f2 2012-08-29 16:45:51.000000000 +0800 @@ -1,7 +1,7 @@ a a a -a +b a a a
> 

å®ƒçš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ã€‚

> 
> 
> 
> --- f1 2012-08-29 16:45:41.000000000 +0800 +++ f2 2012-08-29 16:45:51.000000000 +0800
> 

"---"è¡¨ç¤ºå˜åŠ¨å‰çš„æ–‡ä»¶ï¼Œ"+++"è¡¨ç¤ºå˜åŠ¨åçš„æ–‡ä»¶ã€‚

ç¬¬äºŒéƒ¨åˆ†ï¼Œå˜åŠ¨çš„ä½ç½®ç”¨ä¸¤ä¸ª@ä½œä¸ºèµ·é¦–å’Œç»“æŸã€‚

> @@ -1,7 +1,7 @@
> 

å‰é¢çš„"-1,7"åˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼š**å‡å·è¡¨ç¤ºç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼ˆå³f1ï¼‰ï¼Œ"1"è¡¨ç¤ºç¬¬1è¡Œï¼Œ"7"è¡¨ç¤ºè¿ç»­7è¡Œ**ã€‚åˆåœ¨ä¸€èµ·ï¼Œå°±è¡¨ç¤ºä¸‹é¢æ˜¯ç¬¬ä¸€ä¸ªæ–‡ä»¶ä»ç¬¬1è¡Œå¼€å§‹çš„è¿ç»­7è¡Œã€‚åŒæ ·çš„ï¼Œ"+1,7"è¡¨ç¤ºå˜åŠ¨åï¼Œæˆä¸ºç¬¬äºŒä¸ªæ–‡ä»¶ä»ç¬¬1è¡Œå¼€å§‹çš„è¿ç»­7è¡Œã€‚

ç¬¬ä¸‰éƒ¨åˆ†æ˜¯å˜åŠ¨çš„å…·ä½“å†…å®¹ã€‚

> a 
a 
a
-a 
+b
 a
 a
 a
> 

é™¤äº†æœ‰å˜åŠ¨çš„é‚£äº›è¡Œä»¥å¤–ï¼Œä¹Ÿæ˜¯ä¸Šä¸‹æ–‡å„æ˜¾ç¤º3è¡Œã€‚å®ƒå°†ä¸¤ä¸ªæ–‡ä»¶çš„ä¸Šä¸‹æ–‡ï¼Œåˆå¹¶æ˜¾ç¤ºåœ¨ä¸€èµ·ï¼Œæ‰€ä»¥å«åš"åˆå¹¶æ ¼å¼"ã€‚æ¯ä¸€è¡Œæœ€å‰é¢çš„æ ‡å¿—ä½ï¼Œç©ºè¡¨ç¤ºæ— å˜åŠ¨ï¼Œå‡å·è¡¨ç¤ºç¬¬ä¸€ä¸ªæ–‡ä»¶åˆ é™¤çš„è¡Œï¼ŒåŠ å·è¡¨ç¤ºç¬¬äºŒä¸ªæ–‡ä»¶æ–°å¢çš„è¡Œã€‚

**å…­ã€gitæ ¼å¼çš„diff**

ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿgitï¼Œä½¿ç”¨çš„æ˜¯åˆå¹¶æ ¼å¼diffçš„å˜ä½“ã€‚

> $ git diff
> 

æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š

> diff --git a/f1 b/f1 
index 6f8a38c..449b072 100644 
--- a/f1 +++ b/f1 
@@ -1,7 +1,7 @@ 
a 
a 
a
-a 
+b
 a
 a
 a
> 

ç¬¬ä¸€è¡Œè¡¨ç¤ºç»“æœä¸ºgitæ ¼å¼çš„diffã€‚

> diff --git a/f1 b/f1
> 

è¿›è¡Œæ¯”è¾ƒçš„æ˜¯ï¼Œaç‰ˆæœ¬çš„f1ï¼ˆå³å˜åŠ¨å‰ï¼‰å’Œbç‰ˆæœ¬çš„f1ï¼ˆå³å˜åŠ¨åï¼‰ã€‚

ç¬¬äºŒè¡Œè¡¨ç¤ºä¸¤ä¸ªç‰ˆæœ¬çš„gitå“ˆå¸Œå€¼ï¼ˆindexåŒºåŸŸçš„6f8a38cå¯¹è±¡ï¼Œä¸å·¥ä½œç›®å½•åŒºåŸŸçš„449b072å¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼‰ï¼Œæœ€åçš„å…­ä½æ•°å­—æ˜¯å¯¹è±¡çš„æ¨¡å¼ï¼ˆæ™®é€šæ–‡ä»¶ï¼Œ644æƒé™ï¼‰ã€‚

> 
> 
> 
> index 6f8a38c..449b072 100644
> 

ç¬¬ä¸‰è¡Œè¡¨ç¤ºè¿›è¡Œæ¯”è¾ƒçš„ä¸¤ä¸ªæ–‡ä»¶ã€‚

> 
> 
> 
> --- a/f1 +++ b/f1
> 

"---"è¡¨ç¤ºå˜åŠ¨å‰çš„ç‰ˆæœ¬ï¼Œ"+++"è¡¨ç¤ºå˜åŠ¨åçš„ç‰ˆæœ¬ã€‚

åé¢çš„è¡Œéƒ½ä¸å®˜æ–¹çš„åˆå¹¶æ ¼å¼diffç›¸åŒã€‚

> 
> 
> 
> @@ -1,7 +1,7 @@ 
> a 
> a 
> a
> -a 
> +b
>  a
>  a
>  a
> 

**ä¸ƒã€é˜…è¯»ææ–™**

- [diff - Wikipedia](https://en.wikipedia.org/wiki/Diff)
- [How to read a patch or diff](http://www.markusbe.com/2009/12/how-to-read-a-patch-or-diff-and-understand-its-structure-to-apply-it-manually/)
- [How to work with diff representation in git](https://stackoverflow.com/questions/2529441/how-to-work-with-diff-representation-in-git)

ï¼ˆå®Œï¼‰

## ç›¸å…³æ–‡ç« 