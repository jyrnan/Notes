# 第一章 概论

# 1.2 协议分层

协议分层的优越性之一是它允许我们将服务从实现中分离出来。一层需要能够接收较低层的一 系列服务，同时向较高层提供服务，而我们不关心这一层是如何实现的

## 1.2.1 场景

![Untitled](%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E6%A6%82%E8%AE%BA%20b28b5e240b8e4eab920da418c154f528/Untitled.png)

### 协议分层的原则

- 第一个原则就是如果想要双向通信，那么我们需要每一层能够 实现两个相反的任务，每个方向上一个。
- 两端每一层中的两个对象应该相同

### 逻辑连接

逻辑连接的概念将帮助我们更好地理解数据通信与网络中遇到的分层任务

<aside>
💡 我的理解是可以把该层下所有层次合并起来看作是一个虚拟逻辑连接

</aside>

## 1.2.2 TCP/IP协议簇

TCP/IP 是目前 Internet 使用的一个 协议簇(按不同层次组织的协议集)。它是由相互交互的模块组成的一个层次结构协议，每一个模 块提供特定的功能。层次意味着较上层次的协议需要得到一个或多个较下层次协议提供的服务支持

![Untitled](%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E6%A6%82%E8%AE%BA%20b28b5e240b8e4eab920da418c154f528/Untitled%201.png)

### 层次化结构

![Untitled](%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E6%A6%82%E8%AE%BA%20b28b5e240b8e4eab920da418c154f528/Untitled%202.png)

### TCP/IP 协议簇中的层次

在进行前面的介绍之后，我们来简单讨论 TCP/IP 协议簇中层次的功能和任务。接下来的 6 章 将对每一层进行详细讨论。为了更好地理解每一层的任务，我们首先需要知道在层次间存在的逻辑 连接。图 1-14 显示了简单互联网的逻辑连接。

![Untitled](%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E6%A6%82%E8%AE%BA%20b28b5e240b8e4eab920da418c154f528/Untitled%203.png)

> 采用逻辑连接使我们考虑每一层的任务变得比较容易。如图 1-14 所示，应用层、传输层和网 络层的任务是端到端的(end-to-end)。但是，数据链路层和物理层的任务是点到点的(hop-to-hop)， 其中一个跳步是一个主机或路由器。也就是说，高三层的任务范围是互联网，低两层的任务范围是 链路。
> 

另一种理解逻辑连接的方法是考虑每一层创建的数据单元。在高三层，数据单元(分组)不应 该被任何路由器或链路层交换机改变。在低两层，主机创建的分组仅仅被路由器改变，链路层交换 机不改变它们。

![Untitled](%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E6%A6%82%E8%AE%BA%20b28b5e240b8e4eab920da418c154f528/Untitled%204.png)

### TCP/IP 各层描述

- 应用层：HTTP协议。**两个应用层之间的逻辑连接是端到端的**
- 传输层：TCP/UDP。**传输层的逻辑连接也是端到端的**。传输层应该独立于应用层。另外，我们将看到传输层有多个协议，这意味着每个应用程序可以使用与它的需求最匹 配的协议。
- 网络层：网络层负责在源计算机和目的计算机之间创建一个连接。**网络层的通信是主机到主机的。**我们可以说网络层负责主机到主机的通信，并且指挥分组通过合适的路由器
    - Internet 的网络层包括其主要协议:因特网协议(Internet Protocol，IP)，因特网协议定义了在 网络层称为数据报的分组格式。IP 同时定义了在这一层使用的地址格式和结构。
    - IP 是一个无连接的协议，不提供流量控制、差错控制和拥塞控制服务。**（我的理解：只提供路径服务）**
    - 网络层也包含一些帮助 IP 转发和进行路由工作的辅助协议。
        - 因特网控制 报文协议(Internet Control Message Protocol，ICMP)帮助 IP 报告遇到的问题
        - 动态主机配置协议(Dynamic Host Configuration Protocol，DHCP
        - 地址解析协议(Address Resolution Protocol，ARP)帮助 IP 寻找一台主机或一台路由器的链路层地
        址
- 数据链路层：TCP/IP 没有为数据链路层定义任何特定的协议。它支持所有标准的和私有的协议。能够接管 数据报并携带它穿过链路的任何协议都能满足网络层的要求。**数据链路层接管一个数据报并将它封 装在一个称为帧(frame)的分组中。**
- 物理层

### 封装和解封装

![Untitled](%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E6%A6%82%E8%AE%BA%20b28b5e240b8e4eab920da418c154f528/Untitled%205.png)

- 源主机的封装
- 路由器的解封装和封装
- 目的路主机解封装

<aside>
💡 由于路由器连接两个或多个链路，因此在路由器中我们既需要进行解封装也需要进行封装。

</aside>

### 地址

在这种模型中一 对层次之间存在逻辑通信。包含两方的任意通信都需要两个地址:源地址和目的地址

![Untitled](%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E6%A6%82%E8%AE%BA%20b28b5e240b8e4eab920da418c154f528/Untitled%206.png)

### 多路复用与多路分解

多路复用的意思是一个协议能够封装来自多个上层协议的分组(一次一个);多路分解的意思是一个协议能够进行解封装， 并且将分组投递到多个上层协议(一次一个)。图 1-18 显示了一个高三层的多路复用与多路分解。

![Untitled](%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E6%A6%82%E8%AE%BA%20b28b5e240b8e4eab920da418c154f528/Untitled%207.png)

## 1.2.3 OSI模型

开放系统(open system)是一个允许任意两个不同系统进行通信的协议集，无论这两个系统采 用何种结构。OSI 模型的主要目标是给出在不改变底层硬件和软件逻辑的情况下，怎样更利于不同 系统之间的通信。**OSI 模型不是一种协议;它是理解和设计具有可扩展性、健壮性和互操作性网络 结构的模型**。OSI 模型的目的是作为创建 OSI 协议栈的基础。

![Untitled](%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E6%A6%82%E8%AE%BA%20b28b5e240b8e4eab920da418c154f528/Untitled%208.png)

### OSI 与 TCP/IP（可以了解一下）

二者的关系。其实并不是特别重要：OSI模型竟然没有成功。

![Untitled](%E7%AC%AC%E4%B8%80%E7%AB%A0%20%E6%A6%82%E8%AE%BA%20b28b5e240b8e4eab920da418c154f528/Untitled%209.png)

## 补充：

### TCP/IP

官方决定将 TCP 分成两个协议:传输控制协议(Transmission Control Protocol，TCP) 和因特网协议(Internet Protocol，IP)。IP 处理数据报的路由选择，TCP 负责高层次的功能，如分 段、重组、检错。这个新的联合体变成了人们知道的 TCP/IP。