# AlamoFire

# åŸºæœ¬æ€è·¯

é‡‡ç”¨é“¾å¼è°ƒç”¨ã€‚å…¶å®ç°çš„ä¸€ä¸ªå…³é”®å°±æ˜¯æ–¹æ³•å§‹ç»ˆè¿”å›çš„è‡ªèº«(SELF)

```swift
AF.download("https://docs-assets.developer.apple.com/published/c42b3a63237d524184a42b157a0e3b03/AppDev_course-hero@2x.png"). //è¿”å›ä¸€ä¸ªRequest
responseURL(completionHandler: {response in
            debugPrint(response)
            if case .success(let path) = response.result {
                self.path = path.path
            }
        }) //ä¾ç„¶è¿”å›ä¸€ä¸ªRequest
```

# Request

AF.Requestæ˜¯æœ€åŸºç¡€ç±»ï¼Œæœ‰è‹¥å¹²ä¸ªå­ç±»ï¼Œä¾‹å¦‚ï¼š

- DataRequest
- DownloadRequest

## å†…éƒ¨æ–¹æ³•

```swift
@discardableResult func responseURL(queue: DispatchQueue = .main, completionHandler: @escaping (AFDownloadResponse<URL>) -> Void) -> Self
```

è¿™äº›å†…éƒ¨æ–¹æ³•çš„ä½œç”¨ä¸¤æ–¹é¢ï¼š

### ä¼ é€’ç±»å‹æ˜¯è‡ªèº«çš„è¿”å›å€¼

Requestå†…éƒ¨æœ‰è‹¥å¹²ä¸ªæ–¹æ³•ï¼Œå…¶è¿”å›å€¼æ˜¯`SELF`ï¼Œä¹Ÿå°±æ˜¯Requestæœ¬èº«ï¼Œä½œç”¨æ˜¯é’ˆå¯¹è¯¥requestä¸æ–­æ·»åŠ å¤„ç†æ–¹å¼æ¡ä»¶ã€‚ç„¶åè¿”å›ç”Ÿæˆæ–°çš„Reuest

åœ¨ä¸æ–­çš„é“¾å¼è°ƒç”¨æ–¹æ³•è¿‡ç¨‹ä¸­æ·»åŠ å‚æ•°ï¼Œå½¢æˆæ›´å®Œå–„çš„Requestä¾›ä¸‹æ¸¸è°ƒç”¨

### CompletionHandler

åœ¨é“¾å¼è°ƒç”¨è¿‡ç¨‹ä¸­ä¼šæ·»åŠ `CompletionHandler`æ¥å¤„ç†Requestè¿”å›çš„response.

**responseçš„å¤„ç†ï¼š**åœ¨requestçš„å†…éƒ¨æ–¹æ³•çš„æä¾›ä¸€ä¸ªcompletionHandlerï¼Œæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹å°±æ˜¯å¯¹è¿™ä¸ª`response`è¿›è¡Œå¤„ç†ï¼Œ

**responseçš„ç±»å‹ï¼š**è¢«è®¾è®¡æˆåŒ…å«ä¸€ä¸ª`Result`ç±»å‹çš„å±æ€§`.result`ã€‚è¿™æ˜¯ç”±ä¸Šå±‚requestè¿”å›çš„å¯èƒ½æ˜¯æ•°æ®æˆ–é”™è¯¯ã€‚åœ¨å†…éƒ¨æ–¹æ³•ä½œç”¨ä¸‹ï¼Œä¼šå¯¹è¿”å›çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¹¶åŒ…è£…åœ¨`Result.success`ä¸­ï¼Œè€Œé”™è¯¯åˆ™æ˜¯`Result.failure` ã€‚

> å…¶å®å¯ä»¥ç›´æ¥å¯¹responseçš„`.value`æˆ–`.error`æ¥æ“ä½œ
> 

<aside>
ğŸ’¡ ä¸¾ä¾‹è¯´æ˜ï¼šè¿™ä¸ª`DownloadRequest`å°±æœ‰ä¸€ä¸ª`ResponseURL`çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­çš„response handlerå°±å’Œå…¶ä»–ä¸ä¸€æ ·ï¼Œ`response`å†…çš„æ•°æ®æ˜¯è¿”å›çš„ä¸€ä¸ªè¯·æ±‚ä¸‹è½½çš„æ•°æ®åœ¨æœ¬åœ°çš„ä¸´æ—¶æ–‡ä»¶URLã€‚å¦‚æœæˆåŠŸè¿™ä¸ªURLå°±æ˜¯ä¸€ä¸ªçœŸæ­£ä¸‹è½½çš„æ–‡ä»¶ï¼Œå¦‚æœå¤±è´¥å°±åªæ˜¯ä¸€ä¸ªç©ºä½ç½®ã€‚æ‰€ä»¥éœ€è¦å¯¹è¿™ä¸ª`response.result`è¿›è¡Œåˆ¤æ–­

</aside>

## DownloadRequest

### ç›®æ ‡åœ°å€

å¯ä»¥æŒ‡å®šä¸‹è½½å­˜å‚¨æ–‡ä»¶çš„ç›®æ ‡åœ°å€ï¼š`DownloadRequest.Destination`

```swift
let destination: DownloadRequest.Destination = { _, _ in
    let documentsURL = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask)[0]
    let fileURL = documentsURL.appendingPathComponent("image.png")

    return (fileURL, [.removePreviousFile, .createIntermediateDirectories]) //åŒ…å«æ–‡ä»¶è·¯å¾„å’Œä¸´æ—¶æ–‡ä»¶çš„å¤„ç†æ–¹å¼
}

AF.download("https://httpbin.org/image/png", to: destination).response { response in
    debugPrint(response)

    if response.error == nil, let imagePath = response.fileURL?.path {
        let image = UIImage(contentsOfFile: imagePath)
    }
}
```

ä¹Ÿæœ‰ç¼ºçœåœ°å€ï¼š

### Download Progress

å¯ä»¥ç”¨æ¥è·å–ä¸‹è½½è¿›åº¦

### Canceling and Resuming a Download

å¯ä»¥å–æ¶ˆä¸‹è½½ä»»åŠ¡ï¼ŒæŒ‡å®šä¸‹è½½ä»»åŠ¡çš„å¤„ç†å›è°ƒæ¥ä¿å­˜æš‚å­˜çš„æ•°æ®ã€‚

resumeçš„æ—¶å€™å¯ä»¥æŒ‡å®šåŸæ¥ä¿å­˜çš„resumeData

## Uploading Request

æœ‰ä¸Šä¼ å’Œä¸‹è½½çš„processåŒæ—¶æŠ¥å‘Šï¼Ÿ

## Stream Request

ææ¸…æ¥šå‡ ä¸ªæ•°æ®ç»“æ„çš„å½¢å¼

Stream 

- Event
    - streamï¼ˆResult<Success, Failure>)
    - completion
        - request
        - response: HTTPURLResponse
        - metrics
        - error
- token
- func cancel

éœ€è¦å¤šä¸ªåˆ¤æ–­ã€‚

```swift
AF.streamRequest(...).responseStream { stream in
    switch stream.event {
    case let .stream(result):
        switch result {
        case let .success(data):
            print(data)
        }
    case let .complete(completion):
        print(completion)
    }
}
```

## Requestçš„æ‰§è¡Œï¼ˆå¾…ç»†åŒ–ï¼‰

æœ€åçš„Requestä¼šè¢«æ·»åŠ åˆ°è®¾ç½®çš„queue ä¸­æ‰§è¡Œï¼ˆé‡Œé¢çš„Taskï¼‰