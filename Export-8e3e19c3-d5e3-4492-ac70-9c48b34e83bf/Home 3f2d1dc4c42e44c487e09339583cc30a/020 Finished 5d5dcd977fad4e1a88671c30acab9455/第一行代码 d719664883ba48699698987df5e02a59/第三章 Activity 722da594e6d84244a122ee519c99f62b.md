# ç¬¬ä¸‰ç«  Activity

<aside>
ğŸ’¡ Activityä¼¼ä¹ç±»ä¼¼äºViewControllerï¼Ÿ

</aside>

# 3.1 ActivityåŸºæœ¬ç”¨æ³•

## æœ€åŸºæœ¬æ–¹æ³•

### æ”¹å†™onCreate

åœ¨è¿™é‡Œè®¾ç½®åŠ è½½å“ªä¸ªå¸ƒå±€æ–‡ä»¶

```kotlin
class FirstActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
				setContentView(R.layout.first_layout) // è®¾ç½®åŠ è½½çš„å¸ƒå±€æ–‡ä»¶ã€‚
} }
```

æ‰€ä»¥ï¼Œéœ€è¦åœ¨resæ–‡ä»¶å¤¹ä¸­åˆ›å»ºç›¸åº”çš„å¸ƒå±€æ–‡ä»¶

<aside>
ğŸ’¡ å¸ƒå±€æ–‡ä»¶åŸºæœ¬éƒ½æ˜¯ç”¨xmlæ¥å®ç°
å¸ƒå±€æ–‡ä»¶ä¸­çš„å…ƒä»¶éƒ½ä¼šè¢«æ³¨å†Œåˆ°Rä¸­ï¼Œè‡ªåŠ¨ç”Ÿæˆå˜é‡
åœ¨Activityçš„æ–¹æ³•ä¸­å¯ä»¥ç›´æ¥é€šè¿‡idæ¥ä½¿ç”¨

</aside>

### 3.2.3 åœ¨AndroidManifestæ–‡ä»¶ä¸­æ³¨å†ŒActivity

æ‰€æœ‰çš„Activityéƒ½è¦åœ¨AndroidManifest.xmlä¸­è¿›è¡Œæ³¨å†Œæ‰èƒ½ç”Ÿæ•ˆ

```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    <application
        android:allowBackup="true"
        android:dataExtractionRules="@xml/data_extraction_rules"
        android:fullBackupContent="@xml/backup_rules"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/Theme.MyApplicationNoActivity"
        tools:targetApi="31">
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:label="This is FirstActivity">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />

                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
            </activity>
    </application>
```

### 3.2.4 åˆ©ç”¨Toastå¼¹å‡ºæ¶ˆæ¯

- Toastæ˜¯ä¸€ä¸ªViewï¼Œæœ‰ç¬¦åˆsetOnClickæ¥å£çš„æ–¹æ³•
- åœ¨buttoné‡Œæ·»åŠ Toast

```kotlin
override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    setContentView(R.layout.first_layout)
    val button1: Button = findViewById(R.id.button1)
    button1.setOnClickListener {
        Toast.makeText(this, "You clicked Button 1", Toast.LENGTH_SHORT).show()
    }
}
```

### 3.2.5 åœ¨Activityä¸­ä½¿ç”¨Menu

- åœ¨resä¸‹æ–°å»ºç›®å½•
- å†æ–°å»ºMenu Resourcefile
- åœ¨Activityä¸­é‡å†™ç›¸åº”æ–¹æ³•

```kotlin
override fun onCreateOptionsMenu(menu: Menu?): Boolean {
    menuInflater.inflate(R.menu.main, menu)
    return true
}
```

è€Œæˆ‘ä»¬åˆšæ‰åœ¨onCreateOptionsMenu()æ–¹æ³•ä¸­ç¼–å†™çš„menuInflaterå°±ä½¿ç”¨äº†è¿™ç§è¯­æ³•ç³–ï¼Œ å®ƒå®é™…ä¸Šæ˜¯è°ƒç”¨äº†çˆ¶ç±»çš„getMenuInflater()æ–¹æ³•ã€‚getMenuInflater()æ–¹æ³•èƒ½å¤Ÿå¾—åˆ°ä¸€ ä¸ªMenuInflaterå¯¹è±¡ï¼Œå†è°ƒç”¨å®ƒçš„inflate()æ–¹æ³•ï¼Œå°±å¯ä»¥ç»™å½“å‰Activityåˆ›å»ºèœå•äº†ã€‚ inflate()æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°:ç¬¬ä¸€ä¸ªå‚æ•°ç”¨äºæŒ‡å®šæˆ‘ä»¬é€šè¿‡å“ªä¸€ä¸ªèµ„æºæ–‡ä»¶æ¥åˆ›å»ºèœå•ï¼Œè¿™ é‡Œå½“ç„¶æ˜¯ä¼ å…¥R.menu.main;ç¬¬äºŒä¸ªå‚æ•°ç”¨äºæŒ‡å®šæˆ‘ä»¬çš„èœå•é¡¹å°†æ·»åŠ åˆ°å“ªä¸€ä¸ªMenuå¯¹è±¡å½“ ä¸­ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨onCreateOptionsMenu()æ–¹æ³•ä¸­ä¼ å…¥çš„menuå‚æ•°ã€‚

### 3.2.6 é”€æ¯ä¸€ä¸ªActivity

åœ¨æ§ä»¶ä¸­è°ƒç”¨ç›¸åº”æ–¹æ³•`finish()`

```kotlin
button1.setOnClickListener {
    finish()
}
```

# 3.3 ä½¿ç”¨intentåœ¨Activityä¹‹é—´ç©¿æ¢­

## intent

Intentæ˜¯Androidç¨‹åºä¸­å„ç»„ä»¶ä¹‹é—´è¿›è¡Œäº¤äº’çš„ä¸€ç§é‡è¦æ–¹å¼ï¼Œå®ƒä¸ä»…å¯ä»¥æŒ‡æ˜å½“å‰ç»„ä»¶æƒ³è¦æ‰§ è¡Œçš„åŠ¨ä½œï¼Œè¿˜å¯ä»¥åœ¨ä¸åŒç»„ä»¶ä¹‹é—´ä¼ é€’æ•°æ®ã€‚Intentä¸€èˆ¬å¯ç”¨äºå¯åŠ¨Activityã€å¯åŠ¨Serviceä»¥ åŠå‘é€å¹¿æ’­ç­‰åœºæ™¯ï¼Œç”±äºServiceã€å¹¿æ’­ç­‰æ¦‚å¿µä½ æš‚æ—¶è¿˜æœªæ¶‰åŠï¼Œé‚£ä¹ˆæœ¬ç« æˆ‘ä»¬çš„ç›®å…‰æ— ç–‘å°±é” å®šåœ¨äº†å¯åŠ¨Activityä¸Šé¢ã€‚

Intentå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç§:æ˜¾å¼Intentå’Œéšå¼Intentã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æ˜¾å¼Intentå¦‚ä½•ä½¿ç”¨ã€‚

Intentæœ‰å¤šä¸ªæ„é€ å‡½æ•°çš„é‡è½½ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯Intent(Context packageContext, Class<?
> cls)ã€‚è¿™ä¸ªæ„é€ å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°:

- ç¬¬ä¸€ä¸ªå‚æ•°Contextè¦æ±‚æä¾›ä¸€ä¸ªå¯åŠ¨Activityçš„ä¸Šä¸‹æ–‡;
- ç¬¬äºŒä¸ªå‚æ•°Classç”¨äºæŒ‡å®šæƒ³è¦å¯åŠ¨çš„ç›®æ ‡Activityï¼Œ

é€šè¿‡è¿™ä¸ªæ„é€ å‡½æ•°å°±å¯ä»¥æ„å»ºå‡ºIntentçš„â€œæ„å›¾â€ã€‚

é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬åº”è¯¥æ€ä¹ˆä½¿ç”¨è¿™ä¸ªIntentå‘¢?Activityç±»ä¸­æä¾›äº†ä¸€ä¸ª`startActivity()`æ–¹æ³•ï¼Œä¸“é—¨ç”¨äºå¯åŠ¨Activityï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªIntentå‚æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬å°†æ„å»ºå¥½çš„Intentä¼ å…¥`startActivity()`æ–¹æ³•å°±å¯ä»¥å¯åŠ¨ç›®æ ‡Activityäº†ã€‚

å®ä¾‹ï¼šæŠŠstartActivity()æ–¹æ³•æ·»åŠ åˆ°æ§ä»¶ç›¸åº”ä¸­

```kotlin
button1.setOnClickListener {
    val intent = Intent(this, SecondActivity::class.java) // æ³¨
    startActivity(intent)
}
```

> æ³¨ï¼šSecondActivity::class.javaçš„å†™æ³•å°±ç›¸å½“äºJavaä¸­SecondActivity.classçš„å†™æ³•ã€‚
> 

### 3.3.2 ä½¿ç”¨éšå¼Intent

ç›¸æ¯”äºæ˜¾å¼Intentï¼Œéšå¼Intentåˆ™å«è“„äº†è®¸å¤šï¼Œå®ƒå¹¶ä¸æ˜ç¡®æŒ‡å‡ºæƒ³è¦å¯åŠ¨å“ªä¸€ä¸ªActivityï¼Œè€Œæ˜¯æŒ‡å®šäº†ä¸€ç³»åˆ—æ›´ä¸ºæŠ½è±¡çš„actionå’Œcategoryç­‰ä¿¡æ¯ï¼Œç„¶åäº¤ç”±ç³»ç»Ÿå»åˆ†æè¿™ä¸ªIntentï¼Œå¹¶å¸®æˆ‘ä»¬æ‰¾å‡ºåˆé€‚çš„Activityå»å¯åŠ¨ã€‚

**ä»€ä¹ˆå«ä½œåˆé€‚çš„Activityå‘¢?**

ç®€å•æ¥è¯´å°±æ˜¯å¯ä»¥å“åº”è¿™ä¸ªéšå¼Intentçš„Activityã€‚

é€šè¿‡åœ¨<activity>æ ‡ç­¾ä¸‹é…ç½®<intent-filter>çš„å†…å®¹ï¼Œå¯ä»¥æŒ‡å®šå½“å‰Activityèƒ½å¤Ÿå“åº”çš„ actionå’Œcategoryï¼Œ

```kotlin
<activity android:name=".SecondActivity" >
    <intent-filter>
        <action android:name="com.example.activitytest.ACTION_START" />
        <category android:name="android.intent.category.DEFAULT" />
    </intent-filter>
</activity>
```

actionå’Œcategoryéœ€è¦åŒæ—¶åŒ¹é…

æ¯ä¸ªIntentä¸­åªèƒ½æŒ‡å®šä¸€ä¸ªactionï¼Œä½†èƒ½æŒ‡å®šå¤šä¸ªcategoryã€‚

<aside>
ğŸ’¡ é€šè¿‡å„ç§éšå¼intentå¯ä»¥è°ƒç”¨ç³»ç»Ÿå†…å„ä¸ªåº”ç”¨ï¼ˆActivityï¼‰

</aside>

### 3.3.4 é€šè¿‡Intentä¼ å€¼

Intentä¸­æä¾›äº†ä¸€ç³»åˆ—putExtra()æ–¹æ³•çš„é‡è½½ï¼Œå¯ä»¥æŠŠæˆ‘ä»¬æƒ³è¦ä¼ é€’çš„æ•°æ®æš‚å­˜åœ¨Intentä¸­ï¼Œ

åœ¨å¯åŠ¨å¦ä¸€ä¸ªActivityåï¼Œåªéœ€è¦æŠŠè¿™äº›æ•°æ®ä» Intentä¸­å–å‡ºå°±å¯ä»¥äº†ã€‚

```kotlin
button1.setOnClickListener {
    val data = "Hello SecondActivity"
    val intent = Intent(this, SecondActivity::class.java)
    intent.putExtra("extra_data", data)
    startActivity(intent)
}
```

è¿™é‡ŒputExtra()æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é”®ï¼Œç”¨äºä¹‹åä» Intentä¸­å–å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ‰æ˜¯çœŸæ­£è¦ä¼ é€’çš„æ•°æ®ã€‚

```kotlin
class SecondActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.second_layout)
        val extraData = intent.getStringExtra("extra_data")
        Log.d("SecondActivity", "extra data is $extraData")
} }
```

### è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªå€¼ç»™ä¸Šä¸€ä¸ªActivityğŸ˜‚

# 3.4 Activityçš„ç”Ÿå‘½å‘¨æœŸ

## 3.4.1 è¿”å›æ ˆ

å…¶å®Androidæ˜¯ä½¿ç”¨ä»»åŠ¡(task)æ¥ç®¡ç†Activityçš„ï¼Œä¸€ä¸ªä»»åŠ¡å°±æ˜¯ä¸€ç»„å­˜æ”¾åœ¨æ ˆé‡Œçš„Activity çš„é›†åˆï¼Œè¿™ä¸ªæ ˆä¹Ÿè¢«ç§°ä½œè¿”å›æ ˆ(back stack)

## 3.4.2 ActivityçŠ¶æ€

- è¿è¡Œ
- æš‚åœ
- åœæ­¢
- é”€æ¯

## **3.4.3 Activity**çš„ç”Ÿå­˜æœŸ

7ä¸ªæ–¹æ³•ä¸­é™¤äº†onRestart()æ–¹æ³•ï¼Œå…¶ä»–éƒ½æ˜¯ä¸¤ä¸¤ç›¸å¯¹çš„ï¼Œä»è€Œåˆå¯ä»¥å°†Activityåˆ†ä¸ºä»¥ ä¸‹3ç§ç”Ÿå­˜æœŸ

### å®Œæ•´ç”Ÿå­˜æœŸã€‚

Activityåœ¨onCreate()æ–¹æ³•å’ŒonDestroy()æ–¹æ³•ä¹‹é—´æ‰€ç»å†çš„å°±æ˜¯å®Œæ•´ç”Ÿ å­˜æœŸã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªActivityä¼šåœ¨onCreate()æ–¹æ³•ä¸­å®Œæˆå„ç§åˆå§‹åŒ–æ“ä½œï¼Œè€Œåœ¨ onDestroy()æ–¹æ³•ä¸­å®Œæˆé‡Šæ”¾å†…å­˜çš„æ“ä½œã€‚ 

### å¯è§ç”Ÿå­˜æœŸã€‚

Activityåœ¨onStart()æ–¹æ³•å’ŒonStop()æ–¹æ³•ä¹‹é—´æ‰€ç»å†çš„å°±æ˜¯å¯è§ç”Ÿå­˜ æœŸã€‚åœ¨å¯è§ç”Ÿå­˜æœŸå†…ï¼ŒActivityå¯¹äºç”¨æˆ·æ€»æ˜¯å¯è§çš„ï¼Œå³ä¾¿æœ‰å¯èƒ½æ— æ³•å’Œç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚æˆ‘ ä»¬å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•åˆç†åœ°ç®¡ç†é‚£äº›å¯¹ç”¨æˆ·å¯è§çš„èµ„æºã€‚æ¯”å¦‚åœ¨onStart()æ–¹æ³•ä¸­å¯¹èµ„ æºè¿›è¡ŒåŠ è½½ï¼Œè€Œåœ¨onStop()æ–¹æ³•ä¸­å¯¹èµ„æºè¿›è¡Œé‡Šæ”¾ï¼Œä»è€Œä¿è¯å¤„äºåœæ­¢çŠ¶æ€çš„Activityä¸ ä¼šå ç”¨è¿‡å¤šå†…å­˜ã€‚ 

### å‰å°ç”Ÿå­˜æœŸã€‚

Activityåœ¨onResume()æ–¹æ³•å’ŒonPause()æ–¹æ³•ä¹‹é—´æ‰€ç»å†çš„å°±æ˜¯å‰å°ç”Ÿå­˜ æœŸã€‚åœ¨å‰å°ç”Ÿå­˜æœŸå†…ï¼ŒActivityæ€»æ˜¯å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œæ­¤æ—¶çš„Activityæ˜¯å¯ä»¥å’Œç”¨æˆ·è¿›è¡Œäº¤äº’ çš„ï¼Œæˆ‘ä»¬å¹³æ—¶çœ‹åˆ°å’Œæ¥è§¦æœ€å¤šçš„å°±æ˜¯è¿™ä¸ªçŠ¶æ€ä¸‹çš„Activityã€‚

![Untitled](%E7%AC%AC%E4%B8%89%E7%AB%A0%20Activity%20722da594e6d84244a122ee519c99f62b/Untitled.png)

### 3.4.5 Activityè¢«å›æ”¶

å¯ä»¥é€šè¿‡åœ¨å›æ”¶å‰ä¿å­˜æ•°æ®

```kotlin
override fun onSaveInstanceState(outState: Bundle) {
    super.onSaveInstanceState(outState)
    val tempData = "Something you just typed"
    outState.putString("data_key", tempData)
}
```

å¦‚æœéœ€è¦é‡æ–°åˆ›å»ºï¼Œå¯ä»¥åœ¨onCreatæ–¹æ³•ä¸­æ¢å¤æ•°æ®

```kotlin
override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    Log.d(tag, "onCreate")
    setContentView(R.layout.activity_main)
    if (savedInstanceState != null) {
        val tempData = savedInstanceState.getString("data_key")
        Log.d(tag, "tempData is $tempData")
}
... }
```