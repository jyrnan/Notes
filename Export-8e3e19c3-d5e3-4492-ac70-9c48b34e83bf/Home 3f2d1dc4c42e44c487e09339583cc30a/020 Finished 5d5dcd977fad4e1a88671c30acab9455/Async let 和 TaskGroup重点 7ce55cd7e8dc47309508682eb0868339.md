# Async let å’Œ TaskGroupé‡ç‚¹

```swift
import UIKit
import _Concurrency

func asyncWork(num: Int) async -> Int {
    let delay = UInt64(arc4random_uniform(8))
    try? await Task.sleep(nanoseconds: 1000000000 * delay)
    print(#function, "delay:  \(delay) seconds")
    return Int(delay)
}

Task{
    print("Started")
    
    let result = await withTaskGroup(of: Int.self, returning: [Int].self) { group in
        for i in 1..<5 {
            group.addTask {
                await asyncWork(num: i)
            }
        }
        var result: [Int] = []
        for await i in group {
            print(i)
            result.append(i)
        }
        return result
    }
    print(result)
    print("Ended")
}
```

`TaskGroup`ä¸­ï¼š

- of: æ˜¯å•ä¸ªä»»åŠ¡è¿”å›çš„ç±»å‹
- returning: æ˜¯æ•´ä¸ªä»»åŠ¡ç»„è¿”å›çš„ç±»å‹ï¼ˆå¯é€‰ï¼‰

### `async-let` ä¸ä»»åŠ¡ç»„çš„å…³ç³»

äº‹å®ä¸Šï¼Œ`async-let` å’Œä»»åŠ¡ç»„éƒ½æœ‰ä»»åŠ¡ä¾èµ–æ ‘çš„æ¦‚å¿µï¼Œå³ä¸€ä¸ªçˆ¶ä»»åŠ¡æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå­ä»»åŠ¡ï¼Œè€Œè¿™ä¸ªçˆ¶ä»»åŠ¡åˆæ˜¯å®ƒçš„çˆ¶ä»»åŠ¡çš„å­ä»»åŠ¡ã€‚å½“ä¸€ä¸ªå­ä»»åŠ¡å› ä¸ºé”™è¯¯è€Œå¯¼è‡´çˆ¶ä»»åŠ¡éœ€è¦æŠ›å‡ºé”™è¯¯é€€å‡ºæ—¶ï¼Œè¿™ä¸ªå­ä»»åŠ¡çš„å…„å¼Ÿä»»åŠ¡ä¼šè¢«æ ‡è®°å–æ¶ˆï¼Œçˆ¶ä»»åŠ¡éœ€è¦ç­‰å¾…è¿™äº›ä»»åŠ¡å®Œæˆæˆ–è€…æŠ›å‡ºé”™è¯¯ï¼ˆä½†ä¼šå¿½ç•¥è¿™äº›ä»»åŠ¡çš„è¿”å›å€¼æˆ–è€…é”™è¯¯ï¼‰ï¼Œæ‰èƒ½çœŸæ­£é€€å‡ºã€‚

`async-let` å¯ä»¥çœ‹åšç®€åŒ–ç‰ˆçš„ä»»åŠ¡ç»„ï¼ˆå®é™…ä¸Šå¹¶ä¸æ˜¯ä»»åŠ¡ç»„çš„è¯­æ³•ç³–ï¼‰ï¼Œéå¸¸é€‚åˆå¤„ç†**ä¸åŒè¿”å›ç±»å‹**çš„å¼‚æ­¥ä»»åŠ¡ï¼Œç­‰å¾…è¿™äº›å¼‚æ­¥ä»»åŠ¡çš„è¿”å›ç»“æœï¼Œç„¶åç»„åˆå®ƒä»¬å†ç»§ç»­åé¢çš„ä»»åŠ¡ã€‚

è€Œä»»åŠ¡ç»„æ›´é€‚åˆå¤„ç†**æ•°é‡ä¸å®šçš„ç›¸åŒè¿”å›ç±»å‹**çš„å¼‚æ­¥ä»»åŠ¡ï¼Œåœ¨éå†ä»»åŠ¡ç»„çš„è¿”å›ç»“æœæ—¶å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿”å›ç»“æœã€‚ä¾‹å¦‚ä¸¤ä¸ªç›¸åŒè¿”å›ç±»å‹çš„ä»»åŠ¡ï¼Œåªéœ€è¦å¤„ç†ç¬¬ä¸€ä¸ªè¿”å›çš„ç»“æœï¼Œä»»åŠ¡ç»„éå¸¸æ–¹ä¾¿ï¼Œä½† `async-let` éš¾ä»¥å®ç°ã€‚

### å°ç»“

<aside>
ğŸ’¡ å¹¶å‘çš„å¥—è·¯æ˜¯ï¼š
* å…ˆåˆ›å»ºå¹¶å‘ä»»åŠ¡ `asyncÂ let` æˆ–è€… `withThrowingTaskGroup { group in ...}`
* å†awaitè·å–ä»»åŠ¡çš„è¿”å›å€¼

</aside>

åªæœ‰ `async` / `await` çš„ä»£ç æ˜¯ä¸å…·å¤‡å¹¶å‘èƒ½åŠ›çš„ï¼Œç»“æ„åŒ–å¹¶å‘çš„åŠ å…¥è®©æˆ‘ä»¬å¾—ä»¥ç”¨å°‘é‡çš„ä»£ç åœ¨ `async` / `await` çš„åŸºç¡€ä¸Šå®ç°å¹¶å‘ç¼–ç¨‹ï¼ŒåŒæ—¶èƒ½å¤Ÿç»§ç»­ä½¿ç”¨é”™è¯¯å¤„ç†å’Œçº¿æ€§æ§åˆ¶æµã€‚